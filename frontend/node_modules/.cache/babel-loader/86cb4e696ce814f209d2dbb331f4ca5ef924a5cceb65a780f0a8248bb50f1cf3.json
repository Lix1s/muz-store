{"ast":null,"code":"import React,{useState}from\"react\";import\"./login.css\";import{Navigate}from\"react-router-dom\";import{Link}from'react-router-dom';import{useDispatch,useSelector}from'react-redux';import Header from'../../components/header/Header';import{useForm}from'react-hook-form';import{fetchAuth,selectIsAuth}from\"../../redux/slices/auth\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";export const Login=()=>{const isAuth=useSelector(selectIsAuth);const dispatch=useDispatch();const[redirectToAdmin,setRedirectToAdmin]=useState(false);// Для перенаправления в админку\nconst[redirectToHome,setRedirectToHome]=useState(false);// Для перенаправления на главную страницу\nconst{register,handleSubmit,formState:{errors,isValid}}=useForm({defaultValues:{email:'',password:''},mode:'onChange'});const[showErrors,setShowErrors]=useState(false);const onSubmit=async values=>{// Проверка логина и пароля как admin\nif(values.email==='admin@admin.com'&&values.password==='admin'){// Устанавливаем флаг для перенаправления в админку\nsetRedirectToAdmin(true);return;}// Отправка данных для обычной авторизации через Redux\nconst data=await dispatch(fetchAuth(values));if(!data.payload){return alert('Неверная почта или пароль');}// Если токен получен, сохраняем его в localStorage\nif('token'in data.payload){window.localStorage.setItem('token',data.payload.token);}// Перенаправление на главную или админскую страницу в зависимости от роли\nif(data.payload.role==='admin'){setRedirectToAdmin(true);}else{setRedirectToHome(true);}};const handleFormSubmit=data=>{setShowErrors(true);// Включаем отображение ошибок после клика\nhandleSubmit(onSubmit)(data);// Вызываем отправку формы\n};// Если пользователь уже авторизован, перенаправляем на главную\nif(isAuth){return/*#__PURE__*/_jsx(Navigate,{to:\"/\"});}// Перенаправление в зависимости от флага\nif(redirectToAdmin){return/*#__PURE__*/_jsx(Navigate,{to:\"/admin\"});}if(redirectToHome){return/*#__PURE__*/_jsx(Navigate,{to:\"/\"});}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Header,{}),/*#__PURE__*/_jsx(\"section\",{className:\"Login\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"preview\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-center\",children:\"\\u0412\\u0445\\u043E\\u0434\"}),/*#__PURE__*/_jsx(\"div\",{className:\"registration-cssave\",children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit(onSubmit),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"input\",{className:\"form-control-item\",type:\"email\",placeholder:\"Email\",...register(\"email\",{required:\"Введите почту\",pattern:{value:/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/,message:\"Введите корректный email\"}})}),showErrors&&errors.email&&/*#__PURE__*/_jsx(\"p\",{className:\"check\",children:errors.email.message})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"input\",{className:\"form-control-item\",type:\"password\",placeholder:\"\\u041F\\u0430\\u0440\\u043E\\u043B\\u044C\",...register(\"password\",{required:\"Введите пароль\",minLength:{value:5,message:\"Минимум 6 символов\"}})}),showErrors&&errors.password&&/*#__PURE__*/_jsx(\"p\",{className:\"check\",children:errors.password.message})]}),/*#__PURE__*/_jsx(\"div\",{className:\"form-group\",children:/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary btn-block create-account\",type:\"submit\",onClick:handleFormSubmit,children:\"\\u0412\\u041E\\u0419\\u0422\\u0418\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"form-group\",children:/*#__PURE__*/_jsx(Link,{to:\"/register\",children:/*#__PURE__*/_jsxs(\"button\",{className:\"register\",type:\"submit\",children:[\"\\u041D\\u0435\\u0442 \\u0430\\u043A\\u043A\\u0430\\u0443\\u043D\\u0442\\u0430? \",/*#__PURE__*/_jsx(\"a\",{children:\"\\u0417\\u0430\\u0440\\u0435\\u0433\\u0438\\u0441\\u0442\\u0440\\u0438\\u0440\\u043E\\u0432\\u0430\\u0442\\u044C\\u0441\\u044F\"})]})})})]})})]})})]});};export default Login;","map":{"version":3,"names":["React","useState","Navigate","Link","useDispatch","useSelector","Header","useForm","fetchAuth","selectIsAuth","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","Login","isAuth","dispatch","redirectToAdmin","setRedirectToAdmin","redirectToHome","setRedirectToHome","register","handleSubmit","formState","errors","isValid","defaultValues","email","password","mode","showErrors","setShowErrors","onSubmit","values","data","payload","alert","window","localStorage","setItem","token","role","handleFormSubmit","to","children","className","type","placeholder","required","pattern","value","message","minLength","onClick"],"sources":["C:/Users/lakir/Desktop/lastTry/frontend/src/pages/login/Login.jsx"],"sourcesContent":["import React, { useState } from \"react\";\r\nimport \"./login.css\";\r\nimport { Navigate } from \"react-router-dom\";\r\nimport { Link } from 'react-router-dom'\r\nimport { useDispatch, useSelector } from 'react-redux'\r\nimport Header from '../../components/header/Header'\r\nimport { useForm } from 'react-hook-form'\r\nimport { fetchAuth, selectIsAuth } from \"../../redux/slices/auth\";\r\n\r\nexport const Login = () => {\r\n  \r\n  const isAuth = useSelector(selectIsAuth);\r\n  const dispatch = useDispatch();\r\n  const [redirectToAdmin, setRedirectToAdmin] = useState(false); // Для перенаправления в админку\r\n  const [redirectToHome, setRedirectToHome] = useState(false); // Для перенаправления на главную страницу\r\n  const { \r\n    register,\r\n    handleSubmit,\r\n    formState: { errors, isValid },\r\n  } = useForm({\r\n    defaultValues: {\r\n      email: '',\r\n      password: ''\r\n    },\r\n    mode: 'onChange',\r\n  });\r\n\r\n  const [showErrors, setShowErrors] = useState(false);\r\n\r\n  const onSubmit = async (values) => {\r\n    // Проверка логина и пароля как admin\r\n    if (values.email === 'admin@admin.com' && values.password === 'admin') {\r\n      // Устанавливаем флаг для перенаправления в админку\r\n      setRedirectToAdmin(true);\r\n      return;\r\n    }\r\n\r\n    // Отправка данных для обычной авторизации через Redux\r\n    const data = await dispatch(fetchAuth(values));\r\n\r\n    if (!data.payload) {\r\n      return alert('Неверная почта или пароль');\r\n    }\r\n\r\n    // Если токен получен, сохраняем его в localStorage\r\n    if ('token' in data.payload) {\r\n      window.localStorage.setItem('token', data.payload.token);\r\n    }\r\n\r\n    // Перенаправление на главную или админскую страницу в зависимости от роли\r\n    if (data.payload.role === 'admin') {\r\n      setRedirectToAdmin(true);\r\n    } else {\r\n      setRedirectToHome(true);\r\n    }\r\n  };\r\n\r\n  const handleFormSubmit = (data) => {\r\n    setShowErrors(true); // Включаем отображение ошибок после клика\r\n    handleSubmit(onSubmit)(data); // Вызываем отправку формы\r\n  };\r\n\r\n  // Если пользователь уже авторизован, перенаправляем на главную\r\n  if (isAuth) {\r\n    return <Navigate to=\"/\" />;\r\n  }\r\n\r\n  // Перенаправление в зависимости от флага\r\n  if (redirectToAdmin) {\r\n    return <Navigate to=\"/admin\" />;\r\n  }\r\n  if (redirectToHome) {\r\n    return <Navigate to=\"/\" />;\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <Header />\r\n      <section className=\"Login\">\r\n        <div className=\"preview\">\r\n          <h3 className=\"text-center\">Вход</h3>\r\n          <div className=\"registration-cssave\">\r\n            <form onSubmit={handleSubmit(onSubmit)}>\r\n              <div className=\"form-group\">\r\n                <input\r\n                  className=\"form-control-item\"\r\n                  type=\"email\"\r\n                  placeholder=\"Email\"\r\n                  {...register(\"email\", { \r\n                    required: \"Введите почту\",\r\n                    pattern: {\r\n                      value: /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/,\r\n                      message: \"Введите корректный email\",\r\n                    },\r\n                  })}\r\n                />\r\n                {showErrors && errors.email && <p className=\"check\">{errors.email.message}</p>}\r\n              </div>\r\n              <div className=\"form-group\">\r\n                <input\r\n                  className=\"form-control-item\"\r\n                  type=\"password\"\r\n                  placeholder=\"Пароль\"\r\n                  {...register(\"password\", {\r\n                    required: \"Введите пароль\",\r\n                    minLength: { value: 5, message: \"Минимум 6 символов\" },\r\n                  })}\r\n                />\r\n                {showErrors && errors.password && <p className=\"check\">{errors.password.message}</p>}\r\n              </div>\r\n              <div className=\"form-group\">\r\n                <button className=\"btn btn-primary btn-block create-account\" type=\"submit\" onClick={handleFormSubmit}>\r\n                  ВОЙТИ\r\n                </button>\r\n              </div>\r\n              <div className=\"form-group\">\r\n                <Link to='/register'> \r\n                  <button className=\"register\" type=\"submit\">Нет аккаунта? <a>Зарегистрироваться</a></button>\r\n                </Link>\r\n              </div>\r\n            </form>\r\n          </div>\r\n        </div>\r\n      </section>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default Login;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
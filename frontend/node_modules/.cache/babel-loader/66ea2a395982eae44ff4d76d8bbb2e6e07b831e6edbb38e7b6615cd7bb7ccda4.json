{"ast":null,"code":"import React,{useState,createContext,useEffect,useCallback}from\"react\";import axios from\"axios\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export const CartContext=/*#__PURE__*/createContext();const API_URL=\"https://673876654eb22e24fca800c5.mockapi.io\";const Context=props=>{const[items,setItems]=useState([]);// Товары\nconst[cartItems,setCartItems]=useState([]);// Корзина\nconst[loading,setLoading]=useState(true);// Загрузка данных\nconst[error,setError]=useState(null);// Ошибки\n// Преобразование данных корзины\nconst processedItems=(cartItems===null||cartItems===void 0?void 0:cartItems.map(item=>({...item,price:Number(item.price)})))||[];// Загрузка данных из API\nconst fetchData=useCallback(async()=>{setLoading(true);setError(null);try{const[itemsResponse,cartResponse]=await Promise.allSettled([axios.get(`${API_URL}/items`),axios.get(`${API_URL}/cart`)]);if(itemsResponse.status===\"fulfilled\")setItems(itemsResponse.value.data);if(cartResponse.status===\"fulfilled\")setCartItems(cartResponse.value.data);}catch(err){setError(\"Ошибка при загрузке данных!\");}finally{setLoading(false);}},[]);useEffect(()=>{fetchData();},[fetchData]);// Добавление товара\nconst addProduct=async newProduct=>{try{const{data}=await axios.post(`${API_URL}/items`,newProduct);setItems(prev=>[...prev,data]);}catch(error){console.error(\"Ошибка при добавлении товара:\",error);// Логируем подробности ошибки\n// setError(\"Ошибка при добавлении товара.\");\n}};// Обновление товара\nconst updateProduct=async(id,updatedData)=>{try{const{data}=await axios.put(`${API_URL}/items/${id}`,updatedData);setItems(prev=>prev.map(item=>item.id===id?{...item,...data}:item));}catch(error){setError(\"Ошибка при обновлении товара.\");}};// Удаление товара\nconst deleteProduct=async id=>{try{await axios.delete(`${API_URL}/items/${id}`);setItems(prev=>prev.filter(item=>item.id!==id));}catch(error){setError(\"Ошибка при удалении товара.\");}};const onAddToCart=useCallback(async item=>{try{const existingItem=cartItems.find(cartItem=>cartItem.title===item.title);if(existingItem){// Обновляем количество на сервере\nconst updatedItem={...existingItem,quantity:existingItem.quantity+1};await axios.put(`https://673876654eb22e24fca800c5.mockapi.io/cart/${existingItem.id}`,updatedItem);setCartItems(prevItems=>prevItems.map(el=>el.id===existingItem.id?updatedItem:el));}else{// Добавляем новый товар\nconst newItem={...item,quantity:1};const{data}=await axios.post('https://673876654eb22e24fca800c5.mockapi.io/cart',newItem);setCartItems(prevItems=>[...prevItems,data]);}}catch(error){console.error(\"Ошибка при добавлении товара в корзину:\",error);}},[cartItems]);// Функция для удаления товара из корзины\nconst onRemoveItem=async id=>{try{// Находим товар по ID\nconst itemToUpdate=cartItems.find(item=>item.id===id);if(!itemToUpdate)return;if(itemToUpdate.quantity>1){// Если количество больше 1, уменьшаем количество\nconst updatedItem={...itemToUpdate,quantity:itemToUpdate.quantity-1};await axios.put(`https://673876654eb22e24fca800c5.mockapi.io/cart/${id}`,updatedItem);// Обновляем локальное состояние\nsetCartItems(prevItems=>prevItems.map(item=>item.id===id?updatedItem:item));}else{// Если количество равно 1, удаляем товар полностью\nawait axios.delete(`https://673876654eb22e24fca800c5.mockapi.io/cart/${id}`);setCartItems(prevItems=>prevItems.filter(item=>item.id!==id));}}catch(error){console.error(\"Ошибка при обновлении количества товара:\",error);}};// Функция для проверки, добавлен ли товар в корзину\nconst isItemInCart=title=>{return cartItems.some(cartItem=>cartItem.title===title);};// Состояние для активной категории товаров\nconst[activeCategory,setActiveCategory]=useState('');const value={items,cartItems,processedItems,addProduct,updateProduct,deleteProduct,onAddToCart,onRemoveItem,isItemInCart,activeCategory,setActiveCategory,loading,error};return/*#__PURE__*/_jsxs(CartContext.Provider,{value:value,children:[loading?/*#__PURE__*/_jsx(\"span\",{class:\"loader\"}):props.children,error&&/*#__PURE__*/_jsx(\"p\",{style:{color:\"red\"},children:error})]});};export default Context;","map":{"version":3,"names":["React","useState","createContext","useEffect","useCallback","axios","jsx","_jsx","jsxs","_jsxs","CartContext","API_URL","Context","props","items","setItems","cartItems","setCartItems","loading","setLoading","error","setError","processedItems","map","item","price","Number","fetchData","itemsResponse","cartResponse","Promise","allSettled","get","status","value","data","err","addProduct","newProduct","post","prev","console","updateProduct","id","updatedData","put","deleteProduct","delete","filter","onAddToCart","existingItem","find","cartItem","title","updatedItem","quantity","prevItems","el","newItem","onRemoveItem","itemToUpdate","isItemInCart","some","activeCategory","setActiveCategory","Provider","children","class","style","color"],"sources":["C:/Users/lakir/Desktop/lastTry/frontend/src/components/Context.jsx"],"sourcesContent":["import React, { useState, createContext, useEffect, useCallback } from \"react\";\r\nimport axios from \"axios\";\r\n\r\nexport const CartContext = createContext();\r\n\r\nconst API_URL = \"https://673876654eb22e24fca800c5.mockapi.io\";\r\n\r\nconst Context = (props) => {\r\n  const [items, setItems] = useState([]); // Товары\r\n  const [cartItems, setCartItems] = useState([]); // Корзина\r\n  const [loading, setLoading] = useState(true); // Загрузка данных\r\n  const [error, setError] = useState(null); // Ошибки\r\n\r\n  // Преобразование данных корзины\r\n  const processedItems = cartItems?.map((item) => ({\r\n    ...item,\r\n    price: Number(item.price),\r\n  })) || [];\r\n\r\n  // Загрузка данных из API\r\n  const fetchData = useCallback(async () => {\r\n    setLoading(true);\r\n    setError(null);\r\n    try {\r\n      const [itemsResponse, cartResponse] = await Promise.allSettled([\r\n        axios.get(`${API_URL}/items`),\r\n        axios.get(`${API_URL}/cart`),\r\n      ]);\r\n\r\n      if (itemsResponse.status === \"fulfilled\") setItems(itemsResponse.value.data);\r\n      if (cartResponse.status === \"fulfilled\") setCartItems(cartResponse.value.data);\r\n    } catch (err) {\r\n      setError(\"Ошибка при загрузке данных!\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    fetchData();\r\n  }, [fetchData]);\r\n\r\n  // Добавление товара\r\n  const addProduct = async (newProduct) => {\r\n    try {\r\n      const { data } = await axios.post(`${API_URL}/items`, newProduct);\r\n      setItems((prev) => [...prev, data]);\r\n    } catch (error) {\r\n      console.error(\"Ошибка при добавлении товара:\", error); // Логируем подробности ошибки\r\n      // setError(\"Ошибка при добавлении товара.\");\r\n    }\r\n  };\r\n  \r\n\r\n  // Обновление товара\r\n  const updateProduct = async (id, updatedData) => {\r\n    try {\r\n      const { data } = await axios.put(`${API_URL}/items/${id}`, updatedData);\r\n      setItems((prev) =>\r\n        prev.map((item) => (item.id === id ? { ...item, ...data } : item))\r\n      );\r\n    } catch (error) {\r\n      setError(\"Ошибка при обновлении товара.\");\r\n    }\r\n  };\r\n\r\n  // Удаление товара\r\n  const deleteProduct = async (id) => {\r\n    try {\r\n      await axios.delete(`${API_URL}/items/${id}`);\r\n      setItems((prev) => prev.filter((item) => item.id !== id));\r\n    } catch (error) {\r\n      setError(\"Ошибка при удалении товара.\");\r\n    }\r\n  };\r\n\r\n  const onAddToCart = useCallback(async (item) => {\r\n    try {\r\n      const existingItem = cartItems.find((cartItem) => cartItem.title === item.title);\r\n  \r\n      if (existingItem) {\r\n        // Обновляем количество на сервере\r\n        const updatedItem = { ...existingItem, quantity: existingItem.quantity + 1 };\r\n        await axios.put(`https://673876654eb22e24fca800c5.mockapi.io/cart/${existingItem.id}`, updatedItem);\r\n        setCartItems((prevItems) =>\r\n          prevItems.map((el) => (el.id === existingItem.id ? updatedItem : el))\r\n        );\r\n      } else {\r\n        // Добавляем новый товар\r\n        const newItem = { ...item, quantity: 1 };\r\n        const { data } = await axios.post('https://673876654eb22e24fca800c5.mockapi.io/cart', newItem);\r\n        setCartItems((prevItems) => [...prevItems, data]);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Ошибка при добавлении товара в корзину:\", error);\r\n    }\r\n  }, [cartItems]);\r\n\r\n  // Функция для удаления товара из корзины\r\n  const onRemoveItem = async (id) => {\r\n    try {\r\n      // Находим товар по ID\r\n      const itemToUpdate = cartItems.find((item) => item.id === id);\r\n  \r\n      if (!itemToUpdate) return;\r\n  \r\n      if (itemToUpdate.quantity > 1) {\r\n        // Если количество больше 1, уменьшаем количество\r\n        const updatedItem = { ...itemToUpdate, quantity: itemToUpdate.quantity - 1 };\r\n        await axios.put(`https://673876654eb22e24fca800c5.mockapi.io/cart/${id}`, updatedItem);\r\n  \r\n        // Обновляем локальное состояние\r\n        setCartItems((prevItems) =>\r\n          prevItems.map((item) => (item.id === id ? updatedItem : item))\r\n        );\r\n      } else {\r\n        // Если количество равно 1, удаляем товар полностью\r\n        await axios.delete(`https://673876654eb22e24fca800c5.mockapi.io/cart/${id}`);\r\n        setCartItems((prevItems) => prevItems.filter((item) => item.id !== id));\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Ошибка при обновлении количества товара:\", error);\r\n    }\r\n  };\r\n\r\n  // Функция для проверки, добавлен ли товар в корзину\r\n  const isItemInCart = (title) => {\r\n    return cartItems.some((cartItem) => cartItem.title === title);\r\n  };\r\n\r\n  // Состояние для активной категории товаров\r\n  const [activeCategory, setActiveCategory] = useState('');\r\n\r\n  const value = {\r\n    items,\r\n    cartItems,\r\n    processedItems,\r\n    addProduct,\r\n    updateProduct,\r\n    deleteProduct,\r\n    onAddToCart,\r\n    onRemoveItem,\r\n    isItemInCart,\r\n    activeCategory,\r\n    setActiveCategory,\r\n    loading,\r\n    error,\r\n  };\r\n\r\n  return (\r\n    <CartContext.Provider value={value}>\r\n      {loading ? <span class=\"loader\"></span> : props.children}\r\n      {error && <p style={{ color: \"red\" }}>{error}</p>}\r\n    </CartContext.Provider>\r\n  );\r\n};\r\n\r\nexport default Context;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}